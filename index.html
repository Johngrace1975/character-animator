<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Talking Character</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #0f172a;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-family: Arial, sans-serif;
  color: white;
}

.app {
  text-align: center;
}

.character {
  position: relative;
  width: 220px;
  height: 220px;
  margin-bottom: 15px;
}

.character img {
  width: 100%;
  height: 100%;
}

.eye {
  position: absolute;
  top: 70px;
  width: 25px;
  height: 15px;
  transition: transform 0.15s;
}

.eye.left { left: 70px; }
.eye.right { right: 70px; }

.mouth {
  position: absolute;
  bottom: 45px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 10px;
  transition: height 0.08s ease;
}

button {
  padding: 10px 20px;
  margin: 5px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.record { background: #22c55e; }
.stop { background: #ef4444; color: white; }
</style>
</head>

<body>

<div class="app">
  <div class="character">
    <img src="character.png" alt="Character">

    <img src="eye.png" class="eye left" id="eyeL">
    <img src="eye.png" class="eye right" id="eyeR">

    <img src="mouth.png" class="mouth" id="mouth">
  </div>

  <button class="record" id="recordBtn">üé§ Record</button>
  <button class="stop" id="stopBtn">‚èπ Stop</button>

  <p id="status">Press Record and speak</p>
</div>

<script>
const recordBtn = document.getElementById("recordBtn");
const stopBtn = document.getElementById("stopBtn");
const mouth = document.getElementById("mouth");
const statusText = document.getElementById("status");
const eyeL = document.getElementById("eyeL");
const eyeR = document.getElementById("eyeR");

let audioContext, analyser, mic, dataArray, stream;

recordBtn.onclick = async () => {
  stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  audioContext = new AudioContext();
  analyser = audioContext.createAnalyser();
  mic = audioContext.createMediaStreamSource(stream);
  mic.connect(analyser);
  analyser.fftSize = 256;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  statusText.textContent = "üéô Listening...";
  animateMouth();
};

stopBtn.onclick = () => {
  if (stream) stream.getTracks().forEach(t => t.stop());
  mouth.style.height = "10px";
  statusText.textContent = "Stopped";
};

function animateMouth() {
  analyser.getByteFrequencyData(dataArray);
  let volume = dataArray.reduce((a, b) => a + b) / dataArray.length;
  mouth.style.height = Math.min(60, volume * 0.8) + "px";
  requestAnimationFrame(animateMouth);
}

function blink() {
  eyeL.style.transform = "scaleY(0.1)";
  eyeR.style.transform = "scaleY(0.1)";
  setTimeout(() => {
    eyeL.style.transform = "scaleY(1)";
    eyeR.style.transform = "scaleY(1)";
  }, 150);
}

setInterval(blink, 3000 + Math.random() * 2000);
</script>

</body>
</html>
